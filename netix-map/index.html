<!DOCTYPE html>
<html>
<head>
  <title>Navigation Functions (Heading)</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
  <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBpiCzdbPJc5WGnak7RN5AWaOgeiReP4mM&callback=initMap&libraries=geometry&v=weekly"
      defer
  ></script>
  <style type="text/css">
    /* Always set the map height explicitly to define the size of the div
     * element that contains the map. */
    #map {
      height: 100%;
    }

    /* Optional: Makes the sample page fill the window. */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #floating-panel {
      position: absolute;
      top: 10px;
      left: 25%;
      z-index: 5;
      background-color: #fff;
      padding: 5px;
      border: 1px solid #999;
      text-align: center;
      font-family: "Roboto", "sans-serif";
      line-height: 30px;
      padding-left: 10px;
    }
  </style>
  <script>
      "use strict";

      // This example requires the Geometry library. Include the libraries=geometry
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=geometry">
      // let marker1, marker2;
      // let poly, geodesicPoly;
      //
      // function initMap() {
      //     console.log(google.maps.geometry.spherical);
      //     const map = new google.maps.Map(document.getElementById("map"), {
      //         zoom: 4,
      //         center: {
      //             lat: 34,
      //             lng: -40.605
      //         }
      //     });
      //     map.controls[google.maps.ControlPosition.TOP_CENTER].push(
      //         document.getElementById("info")
      //     );
      //     marker1 = new google.maps.Marker({
      //         map,
      //         draggable: true,
      //         position: {
      //             lat: 40.714,
      //             lng: -74.006
      //         }
      //     });
      //     marker2 = new google.maps.Marker({
      //         map,
      //         draggable: true,
      //         position: {
      //             lat: 48.857,
      //             lng: 2.352
      //         }
      //     });
      //     const bounds = new google.maps.LatLngBounds(
      //         marker1.getPosition(),
      //         marker2.getPosition()
      //     );
      //     map.fitBounds(bounds);
      //     google.maps.event.addListener(marker1, "position_changed", update);
      //     google.maps.event.addListener(marker2, "position_changed", update);
      //     poly = new google.maps.Polyline({
      //         strokeColor: "#FF0000",
      //         strokeOpacity: 1.0,
      //         strokeWeight: 3,
      //         map: map
      //     });
      //     geodesicPoly = new google.maps.Polyline({
      //         strokeColor: "#CC0099",
      //         strokeOpacity: 1.0,
      //         strokeWeight: 3,
      //         geodesic: true,
      //         map: map
      //     });
      //     update();
      // }
      //
      // function update() {
      //     const path = [marker1.getPosition(), marker2.getPosition()];
      //     poly.setPath(path);
      //     geodesicPoly.setPath(path);
      //     const heading = google.maps.geometry.spherical.computeHeading(
      //         path[0],
      //         path[1]
      //     );
      //     document.getElementById("heading").value = String(heading);
      //     document.getElementById("origin").value = String(path[0]);
      //     document.getElementById("destination").value = String(path[1]);
      // }



      var map;

      var curvature = 0.3; // how curvy to make the arc

      function initMap() {
          var Map = google.maps.Map,
              LatLng = google.maps.LatLng,
              LatLngBounds = google.maps.LatLngBounds,
              Marker = google.maps.Marker,
              Point = google.maps.Point;

          // This is the initial location of the points
          // (you can drag the markers around after the map loads)
          var pos1 = new LatLng(40.714, -74.006);
          var pos2 = new LatLng(48.857, 2.352);

          var bounds = new LatLngBounds();
          bounds.extend(pos1);
          bounds.extend(pos2);

          map = new Map(document.getElementById('map'), {
              center: bounds.getCenter(),
              zoom: 3
          });
          map.fitBounds(bounds);

          var markerP1 = new Marker({
              position: pos1,
              label: "1",
              draggable: true,
              map: map
          });
          var markerP2 = new Marker({
              position: pos2,
              label: "2",
              draggable: true,
              map: map
          });

          var curveMarker;

          function updateCurveMarker() {
              var pos1 = markerP1.getPosition(), // latlng
                  pos2 = markerP2.getPosition(),
                  projection = map.getProjection(),
                  p1 = projection.fromLatLngToPoint(pos1), // xy
                  p2 = projection.fromLatLngToPoint(pos2);

              // Calculate the arc.
              // To simplify the math, these points
              // are all relative to p1:
              var e = new Point(p2.x - p1.x, p2.y - p1.y), // endpoint (p2 relative to p1)
                  m = new Point(e.x / 2, e.y / 2), // midpoint
                  o = new Point(e.y, -e.x), // orthogonal
                  c = new Point( // curve control point
                      m.x + curvature * o.x,
                      m.y + curvature * o.y);

              var pathDef = 'M 0,0 ' +
                  'q ' + c.x + ',' + c.y + ' ' + e.x + ',' + e.y;

              var zoom = map.getZoom(),
                  scale = 1 / (Math.pow(2, -zoom));
              console.log(zoom);
              var symbol = {
                  path: pathDef,
                  scale: scale,
                  strokeWeight: 1,
                  fillColor: 'none'
              };

              if (!curveMarker) {
                  curveMarker = new Marker({
                      position: pos1,
                      clickable: false,
                      icon: symbol,
                      zIndex: 0, // behind the other markers
                      map: map
                  });
              } else {
                  curveMarker.setOptions({
                      position: pos1,
                      icon: symbol,
                  });
              }
          }

          google.maps.event.addListener(map, 'projection_changed', updateCurveMarker);
          google.maps.event.addListener(map, 'zoom_changed', updateCurveMarker);

          google.maps.event.addListener(markerP1, 'position_changed', updateCurveMarker);
          google.maps.event.addListener(markerP2, 'position_changed', updateCurveMarker);
      }
  </script>
</head>
<body>
<div id="map"></div>
<div id="floating-panel">
  Origin: <input type="text" readonly id="origin" /> Destination:
  <input type="text" readonly id="destination" /><br />
  Heading: <input type="text" readonly id="heading" /> degrees
</div>
</body>
</html>